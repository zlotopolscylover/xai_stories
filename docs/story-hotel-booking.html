<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Story Hotel Booking: eXplainable predictions of booking cancellation and guests coming back | XAI Stories</title>
  <meta name="description" content="Case studies for eXplainable Artificial Intelligence" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Story Hotel Booking: eXplainable predictions of booking cancellation and guests coming back | XAI Stories" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="Case studies for eXplainable Artificial Intelligence" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Story Hotel Booking: eXplainable predictions of booking cancellation and guests coming back | XAI Stories" />
  
  <meta name="twitter:description" content="Case studies for eXplainable Artificial Intelligence" />
  <meta name="twitter:image" content="images/cover.png" />



<meta name="date" content="2020-10-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="story-house-sale-prices.html"/>
<link rel="next" href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><h3>XAI Stories</h3> Case studies</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a>
<ul>
<li class="chapter" data-level="0.1" data-path="foreword.html"><a href="foreword.html#why"><i class="fa fa-check"></i><b>0.1</b> Why?</a></li>
<li class="chapter" data-level="0.2" data-path="foreword.html"><a href="foreword.html#what"><i class="fa fa-check"></i><b>0.2</b> What?</a></li>
<li class="chapter" data-level="0.3" data-path="foreword.html"><a href="foreword.html#how"><i class="fa fa-check"></i><b>0.3</b> How?</a></li>
<li class="chapter" data-level="0.4" data-path="foreword.html"><a href="foreword.html#about-academic-partners"><i class="fa fa-check"></i><b>0.4</b> About academic partners</a></li>
<li class="chapter" data-level="0.5" data-path="foreword.html"><a href="foreword.html#about-business-partner"><i class="fa fa-check"></i><b>0.5</b> About business partner</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html"><i class="fa fa-check"></i><b>1</b> Story House Sale Prices: eXplainable predictions for house sale</a>
<ul>
<li class="chapter" data-level="" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#take-away-messages"><i class="fa fa-check"></i>Take-away messages</a></li>
<li class="chapter" data-level="1.1" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#data-preperation"><i class="fa fa-check"></i><b>1.2.1</b> Data preperation</a></li>
<li class="chapter" data-level="1.2.2" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#external-data"><i class="fa fa-check"></i><b>1.2.2</b> External data</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#model"><i class="fa fa-check"></i><b>1.3</b> Model</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#linear-models"><i class="fa fa-check"></i><b>1.3.1</b> Linear models</a></li>
<li class="chapter" data-level="1.3.2" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#linear-models-assessment"><i class="fa fa-check"></i><b>1.3.2</b> Linear models assessment</a></li>
<li class="chapter" data-level="1.3.3" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#machine-learning-models"><i class="fa fa-check"></i><b>1.3.3</b> Machine Learning models</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#explanations"><i class="fa fa-check"></i><b>1.4</b> Explanations</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#xai-for-geographical-location"><i class="fa fa-check"></i><b>1.4.1</b> XAI for geographical location</a></li>
<li class="chapter" data-level="1.4.2" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#feature-importance"><i class="fa fa-check"></i><b>1.4.2</b> Feature importance</a></li>
<li class="chapter" data-level="1.4.3" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#partial-dependence-plots-pdp"><i class="fa fa-check"></i><b>1.4.3</b> Partial Dependence Plots (PDP)</a></li>
<li class="chapter" data-level="1.4.4" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#new-possibilities-with-pdp"><i class="fa fa-check"></i><b>1.4.4</b> New possibilities with PDP</a></li>
<li class="chapter" data-level="1.4.5" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#instance-level-explanations."><i class="fa fa-check"></i><b>1.4.5</b> Instance level explanations.</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#use-case-of-the-model"><i class="fa fa-check"></i><b>1.5</b> Use case of the model</a></li>
<li class="chapter" data-level="1.6" data-path="story-house-sale-prices.html"><a href="story-house-sale-prices.html#summary-and-conclusions"><i class="fa fa-check"></i><b>1.6</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html"><i class="fa fa-check"></i><b>2</b> Story Hotel Booking: eXplainable predictions of booking cancellation and guests coming back</a>
<ul>
<li class="chapter" data-level="2.1" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#booking-cancellation"><i class="fa fa-check"></i><b>2.2</b> Booking Cancellation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#booking-cancellation-model"><i class="fa fa-check"></i><b>2.2.1</b> Booking Cancellation: Model</a></li>
<li class="chapter" data-level="2.2.2" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#booking-cancellation-explanation-dataset-level"><i class="fa fa-check"></i><b>2.2.2</b> Booking Cancellation: Explanation, dataset level</a></li>
<li class="chapter" data-level="2.2.3" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#booking-cancellation-explanations-instance-level"><i class="fa fa-check"></i><b>2.2.3</b> Booking Cancellation: Explanations, instance level</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#repeated-guests"><i class="fa fa-check"></i><b>2.3</b> Repeated guests</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#repeated-guests-imbalanced-dataset"><i class="fa fa-check"></i><b>2.3.1</b> Repeated guests: Imbalanced dataset</a></li>
<li class="chapter" data-level="2.3.2" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#repeated-guests-model"><i class="fa fa-check"></i><b>2.3.2</b> Repeated guests: Model</a></li>
<li class="chapter" data-level="2.3.3" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#repeated-guests-explanations-instance-level"><i class="fa fa-check"></i><b>2.3.3</b> Repeated guests: Explanations, instance level</a></li>
<li class="chapter" data-level="2.3.4" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#repeated-guests-explanations-dataset-level"><i class="fa fa-check"></i><b>2.3.4</b> Repeated guests: Explanations, dataset level</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="story-hotel-booking.html"><a href="story-hotel-booking.html#summary-and-conclusions-1"><i class="fa fa-check"></i><b>2.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><i class="fa fa-check"></i><b>3</b> Story Hotel Booking Cancellations: eXplainable predictions for booking cancellation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#problem-specification"><i class="fa fa-check"></i><b>3.2</b> Problem specification</a></li>
<li class="chapter" data-level="3.3" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#target-leak-detection"><i class="fa fa-check"></i><b>3.3</b> Target leak detection</a></li>
<li class="chapter" data-level="3.4" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#bias-correction"><i class="fa fa-check"></i><b>3.4</b> Bias correction</a></li>
<li class="chapter" data-level="3.5" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#offering-different-conditions"><i class="fa fa-check"></i><b>3.5</b> Offering different conditions</a></li>
<li class="chapter" data-level="3.6" data-path="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html"><a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html#conclusions"><i class="fa fa-check"></i><b>3.6</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html"><i class="fa fa-check"></i><b>4</b> Story Uplift Modelling: eXplaining colon cancer survival rate after treatment</a>
<ul>
<li class="chapter" data-level="4.1" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#what-is-uplift-modelling"><i class="fa fa-check"></i><b>4.1.1</b> What is Uplift Modelling?</a></li>
<li class="chapter" data-level="4.1.2" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#dataset-description"><i class="fa fa-check"></i><b>4.1.2</b> Dataset Description</a></li>
<li class="chapter" data-level="4.1.3" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#ideas"><i class="fa fa-check"></i><b>4.1.3</b> Ideas</a></li>
<li class="chapter" data-level="4.1.4" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#why-is-it-worth-the-hassle"><i class="fa fa-check"></i><b>4.1.4</b> Why is it worth the hassle?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#data-preprocessing"><i class="fa fa-check"></i><b>4.2</b> Data Preprocessing</a></li>
<li class="chapter" data-level="4.3" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#model-1"><i class="fa fa-check"></i><b>4.3</b> Model</a></li>
<li class="chapter" data-level="4.4" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#explanations-1"><i class="fa fa-check"></i><b>4.4</b> Explanations</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#feature-importance-1"><i class="fa fa-check"></i><b>4.4.1</b> Feature Importance</a></li>
<li class="chapter" data-level="4.4.2" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#ceteris-paribus-and-partial-dependence-profiles"><i class="fa fa-check"></i><b>4.4.2</b> Ceteris Paribus and Partial Dependence Profiles</a></li>
<li class="chapter" data-level="4.4.3" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#instance-level-explainations"><i class="fa fa-check"></i><b>4.4.3</b> Instance Level Explainations</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="story-uplift-modelling.html"><a href="story-uplift-modelling.html#summary-and-conclusions-2"><i class="fa fa-check"></i><b>4.5</b> Summary and Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html"><i class="fa fa-check"></i><b>5</b> Story Uplift Modeling: eXplainable predictions for optimized marketing campaigns</a>
<ul>
<li class="chapter" data-level="5.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#approaches-towards-uplift-modeling"><i class="fa fa-check"></i><b>5.1.1</b> Approaches towards uplift modeling</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#dataset"><i class="fa fa-check"></i><b>5.2</b> Dataset</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#explanatory-data-analysis"><i class="fa fa-check"></i><b>5.2.1</b> Explanatory Data Analysis</a></li>
<li class="chapter" data-level="5.2.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#feature-engineering"><i class="fa fa-check"></i><b>5.2.2</b> Feature engineering</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#model-exploration-and-metrics"><i class="fa fa-check"></i><b>5.3</b> Model exploration and metrics</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#model-2"><i class="fa fa-check"></i><b>5.3.1</b> Model</a></li>
<li class="chapter" data-level="5.3.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#comparing-metrics"><i class="fa fa-check"></i><b>5.3.2</b> Comparing metrics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#explanations-2"><i class="fa fa-check"></i><b>5.4</b> Explanations</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#instance-level"><i class="fa fa-check"></i><b>5.4.1</b> Instance-level</a></li>
<li class="chapter" data-level="5.4.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#difference---approach"><i class="fa fa-check"></i><b>5.4.2</b> Difference - approach</a></li>
<li class="chapter" data-level="5.4.3" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#dataset--subset--level"><i class="fa fa-check"></i><b>5.4.3</b> Dataset- (subset-) level</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#conclusions-1"><i class="fa fa-check"></i><b>5.5</b> Conclusions</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#sweet-spot"><i class="fa fa-check"></i><b>5.5.1</b> Sweet-spot</a></li>
<li class="chapter" data-level="5.5.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#bigger-influence"><i class="fa fa-check"></i><b>5.5.2</b> Bigger influence</a></li>
<li class="chapter" data-level="5.5.3" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#influence-from-other-factors"><i class="fa fa-check"></i><b>5.5.3</b> Influence from other factors</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#summary"><i class="fa fa-check"></i><b>5.6</b> Summary</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#individual-perspective"><i class="fa fa-check"></i><b>5.6.1</b> Individual perspective</a></li>
<li class="chapter" data-level="5.6.2" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#data-scientists-perspective"><i class="fa fa-check"></i><b>5.6.2</b> Data scientist’s perspective</a></li>
<li class="chapter" data-level="5.6.3" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#executive-perspective"><i class="fa fa-check"></i><b>5.6.3</b> Executive perspective</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="story-uplift-marketing1.html"><a href="story-uplift-marketing1.html#future-works"><i class="fa fa-check"></i><b>5.7</b> Future works</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html"><i class="fa fa-check"></i><b>6</b> Story MEPS: Explainable predictions for healthcare expenditures</a>
<ul>
<li class="chapter" data-level="6.1" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#model-3"><i class="fa fa-check"></i><b>6.2</b> Model</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#data-1"><i class="fa fa-check"></i><b>6.2.1</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#model-4"><i class="fa fa-check"></i><b>6.3</b> Model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#data-2"><i class="fa fa-check"></i><b>6.3.1</b> Data</a></li>
<li class="chapter" data-level="6.3.2" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#model-5"><i class="fa fa-check"></i><b>6.3.2</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#model-level-explainations"><i class="fa fa-check"></i><b>6.4</b> Model Level Explainations</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#permutation-variable-importances"><i class="fa fa-check"></i><b>6.4.1</b> Permutation Variable Importances</a></li>
<li class="chapter" data-level="6.4.2" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#partial-dependence-profiles"><i class="fa fa-check"></i><b>6.4.2</b> Partial Dependence Profiles</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#instance-level-explanations"><i class="fa fa-check"></i><b>6.5</b> Instance Level Explanations</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#business-approach"><i class="fa fa-check"></i><b>6.5.1</b> Business approach</a></li>
<li class="chapter" data-level="6.5.2" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#instance-level-explanations---instance-specific-approach"><i class="fa fa-check"></i><b>6.5.2</b> Instance Level Explanations - instance specific approach</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#summary-and-conclusions-3"><i class="fa fa-check"></i><b>6.6</b> Summary and conclusions</a></li>
<li class="chapter" data-level="6.7" data-path="story-meps-explainable-predictions-for-healthcare-expenditures.html"><a href="story-meps-explainable-predictions-for-healthcare-expenditures.html#references"><i class="fa fa-check"></i><b>6.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html"><i class="fa fa-check"></i><b>7</b> Story MEPS: Healthcare expenditures of individuals</a>
<ul>
<li class="chapter" data-level="7.1" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#data-set"><i class="fa fa-check"></i><b>7.2</b> Data set</a></li>
<li class="chapter" data-level="7.3" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#models"><i class="fa fa-check"></i><b>7.3</b> Models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#model-1-ridge-regression"><i class="fa fa-check"></i><b>7.3.1</b> Model 1: Ridge regression</a></li>
<li class="chapter" data-level="7.3.2" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#model-2-artificial-neural-network"><i class="fa fa-check"></i><b>7.3.2</b> Model 2: Artificial Neural Network</a></li>
<li class="chapter" data-level="7.3.3" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#model-3-gradient-boosting"><i class="fa fa-check"></i><b>7.3.3</b> Model 3: Gradient Boosting</a></li>
<li class="chapter" data-level="7.3.4" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#results"><i class="fa fa-check"></i><b>7.3.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#analysis-with-xai-methods"><i class="fa fa-check"></i><b>7.4</b> Analysis with XAI methods</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#analysis-of-patients-with-zero-expenditures"><i class="fa fa-check"></i><b>7.4.1</b> Analysis of patients with zero expenditures</a></li>
<li class="chapter" data-level="7.4.2" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#interpretation-of-self-reported-health-status-and-survey-questions-design"><i class="fa fa-check"></i><b>7.4.2</b> Interpretation of self-reported health status and survey questions design</a></li>
<li class="chapter" data-level="7.4.3" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#the-relationship-between-age-and-health-expenditure"><i class="fa fa-check"></i><b>7.4.3</b> The relationship between age and health expenditure</a></li>
<li class="chapter" data-level="7.4.4" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#using-shap-for-encoding-and-grouping-of-categorical-variables"><i class="fa fa-check"></i><b>7.4.4</b> Using SHAP for encoding and grouping of categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#conclusion"><i class="fa fa-check"></i><b>7.5</b> Conclusion</a></li>
<li class="chapter" data-level="7.6" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#appendix"><i class="fa fa-check"></i><b>7.6</b> Appendix</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#additionall-plots"><i class="fa fa-check"></i><b>7.6.1</b> Additionall plots</a></li>
<li class="chapter" data-level="7.6.2" data-path="story-meps-healthcare-expenditures-of-individuals.html"><a href="story-meps-healthcare-expenditures-of-individuals.html#variables-descriptions"><i class="fa fa-check"></i><b>7.6.2</b> Variables descriptions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="story-lungs.html"><a href="story-lungs.html"><i class="fa fa-check"></i><b>8</b> Story Lungs: eXplainable predictions for post operational risks</a>
<ul>
<li class="chapter" data-level="8.1" data-path="story-lungs.html"><a href="story-lungs.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="story-lungs.html"><a href="story-lungs.html#data-set-1"><i class="fa fa-check"></i><b>8.2</b> Data set</a></li>
<li class="chapter" data-level="8.3" data-path="story-lungs.html"><a href="story-lungs.html#models-1"><i class="fa fa-check"></i><b>8.3</b> Models</a></li>
<li class="chapter" data-level="8.4" data-path="story-lungs.html"><a href="story-lungs.html#explanations-3"><i class="fa fa-check"></i><b>8.4</b> Explanations</a></li>
<li class="chapter" data-level="8.5" data-path="story-lungs.html"><a href="story-lungs.html#summary-and-conclusions-4"><i class="fa fa-check"></i><b>8.5</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html"><i class="fa fa-check"></i><b>9</b> Story HELOC Credits</a>
<ul>
<li class="chapter" data-level="9.1" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#dataset-1"><i class="fa fa-check"></i><b>9.1.1</b> Dataset</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#model-6"><i class="fa fa-check"></i><b>9.2</b> Model</a></li>
<li class="chapter" data-level="9.3" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#explanations-4"><i class="fa fa-check"></i><b>9.3</b> Explanations</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#model-explanations"><i class="fa fa-check"></i><b>9.3.1</b> Model explanations</a></li>
<li class="chapter" data-level="9.3.2" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#explanation-for-clients"><i class="fa fa-check"></i><b>9.3.2</b> Explanation for clients</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="story-heloc-credits.html"><a href="story-heloc-credits.html#summary-and-conclusion"><i class="fa fa-check"></i><b>9.4</b> Summary and conclusion</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="story-compas.html"><a href="story-compas.html"><i class="fa fa-check"></i><b>10</b> Story COMPAS: recidivism reloaded</a>
<ul>
<li class="chapter" data-level="" data-path="story-compas.html"><a href="story-compas.html#take-away-messages-1"><i class="fa fa-check"></i>Take-away messages</a></li>
<li class="chapter" data-level="10.1" data-path="story-compas.html"><a href="story-compas.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="story-compas.html"><a href="story-compas.html#previous-work-on-compas-algorithm"><i class="fa fa-check"></i><b>10.1.1</b> Previous work on COMPAS algorithm</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="story-compas.html"><a href="story-compas.html#data-3"><i class="fa fa-check"></i><b>10.2</b> Data</a></li>
<li class="chapter" data-level="10.3" data-path="story-compas.html"><a href="story-compas.html#models-2"><i class="fa fa-check"></i><b>10.3</b> Models</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="story-compas.html"><a href="story-compas.html#results---compas-regression"><i class="fa fa-check"></i><b>10.3.1</b> Results - COMPAS Regression</a></li>
<li class="chapter" data-level="10.3.2" data-path="story-compas.html"><a href="story-compas.html#results---recidivism-classification"><i class="fa fa-check"></i><b>10.3.2</b> Results - Recidivism Classification</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="story-compas.html"><a href="story-compas.html#explanations-5"><i class="fa fa-check"></i><b>10.4</b> Explanations</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="story-compas.html"><a href="story-compas.html#model-specific"><i class="fa fa-check"></i><b>10.4.1</b> Model specific</a></li>
<li class="chapter" data-level="10.4.2" data-path="story-compas.html"><a href="story-compas.html#instance-specific"><i class="fa fa-check"></i><b>10.4.2</b> Instance specific</a></li>
<li class="chapter" data-level="10.4.3" data-path="story-compas.html"><a href="story-compas.html#models-without-protected-attributes"><i class="fa fa-check"></i><b>10.4.3</b> Models without protected attributes</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="story-compas.html"><a href="story-compas.html#fairness"><i class="fa fa-check"></i><b>10.5</b> Fairness</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="story-compas.html"><a href="story-compas.html#overview"><i class="fa fa-check"></i><b>10.5.1</b> Overview</a></li>
<li class="chapter" data-level="10.5.2" data-path="story-compas.html"><a href="story-compas.html#models-3"><i class="fa fa-check"></i><b>10.5.2</b> Models</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="story-compas.html"><a href="story-compas.html#summary-and-conclusions-5"><i class="fa fa-check"></i><b>10.6</b> Summary and conclusions</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="story-compas.html"><a href="story-compas.html#next-steps"><i class="fa fa-check"></i><b>10.6.1</b> Next steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">XAI Stories</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="story-hotel-booking" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Story Hotel Booking: eXplainable predictions of booking cancellation and guests coming back</h1>
<p><em>Authors: Domitrz Witalis (MIM), Seweryn Karolina (MiNI)</em></p>
<p><em>Mentors: Jakub Tyrek (Data Scientist), Aleksander Pernach (Consultant)</em></p>
<div id="introduction-1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>The dataset is downloaded from the Kaggle competition website <a href="https://www.kaggle.com/jessemostipak/hotel-booking-demand" class="uri">https://www.kaggle.com/jessemostipak/hotel-booking-demand</a>.
This dataset contains booking information for a city hotel and a resort hotel in Portugal, and includes information such as when the booking was made, length of stay, the number of adults, children, babies, the number of available parking spaces, chosen meals, price etc. There are 119 390 observations and 32 features. Below you can find features which were used in modelling. Furthermore, feature <code>arrival_weekday</code> was added.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>hotel</code></td>
<td>Resort hotel or city hotel</td>
</tr>
<tr class="even">
<td><code>is_canceled</code></td>
<td>Value indicating if the booking was canceled (1) or not (0)</td>
</tr>
<tr class="odd">
<td><code>lead_time</code></td>
<td>Number of days that elapsed between the reservation and the arrival date</td>
</tr>
<tr class="even">
<td><code>arrival_date_month</code></td>
<td>Month of arrival date</td>
</tr>
<tr class="odd">
<td><code>arrival_date_week_number</code></td>
<td>Week number of year for arrival date</td>
</tr>
<tr class="even">
<td><code>stays_in_weekend_nights</code></td>
<td>Number of weekend nights (Saturday or Sunday) the guest stayed or booked to stay at the hotel</td>
</tr>
<tr class="odd">
<td><code>stays_in_week_nights</code></td>
<td>Number of week nights (Monday to Friday) the guest stayed or booked to stay at the hotel</td>
</tr>
<tr class="even">
<td><code>adults</code></td>
<td>Number of adults</td>
</tr>
<tr class="odd">
<td><code>children</code></td>
<td>Number of children</td>
</tr>
<tr class="even">
<td><code>babies</code></td>
<td>Number of babies</td>
</tr>
<tr class="odd">
<td><code>meal</code></td>
<td>Type of meal booked</td>
</tr>
<tr class="even">
<td><code>is_repeated_guest</code></td>
<td>Value indicating if the booking name was from a repeated guest</td>
</tr>
<tr class="odd">
<td><code>previous_cancellations</code></td>
<td>Number of previous bookings that were cancelled by the customer prior to the current booking</td>
</tr>
<tr class="even">
<td><code>previous_bookings_not_canceled</code></td>
<td>Number of previous bookings not cancelled by the customer prior to the current booking</td>
</tr>
<tr class="odd">
<td><code>booking_changes</code></td>
<td>Number of changes made to the booking</td>
</tr>
<tr class="even">
<td><code>deposit_type</code></td>
<td>Indication on if the customer made a deposit to guarantee the booking. Three categories: No Deposit – no deposit was made; Non Refund – a deposit was made in the value of the total stay cost; Refundable – a deposit was made with a value under the total cost of stay</td>
</tr>
<tr class="odd">
<td><code>days_in_waiting_list</code></td>
<td>Number of days the booking was in the waiting list before it was confirmed to the customer</td>
</tr>
<tr class="even">
<td><code>adr</code></td>
<td>Average Daily Rate as defined by dividing the sum of all lodging transactions by the total number of staying nights</td>
</tr>
<tr class="odd">
<td><code>required_car_parking_spaces</code></td>
<td>Number of car parking spaces required by the customer</td>
</tr>
<tr class="even">
<td><code>total_of_special_requests</code></td>
<td>Number of special requests made by the customer (e.g. twin bed or high floor)</td>
</tr>
<tr class="odd">
<td><code>market_segment</code></td>
<td>Market segment designation.</td>
</tr>
<tr class="even">
<td><code>customer_type</code></td>
<td>Contract - when the booking has an allotment or other type of contract associated to it; Group – when the booking is associated to a group; Transient – when the booking is not part of a group or contract, and is not associated to other transient booking; Transient-party – when the booking is transient, but is associated to at least other transient booking</td>
</tr>
<tr class="odd">
<td><code>distribution_channel</code></td>
<td>Booking distribution channel.</td>
</tr>
</tbody>
</table>
<p>The booking website has information about these reservation characteristics and building models can help this company in better offer management. The most important information could be</p>
<ul>
<li>the prediction of booking cancellation,</li>
<li>the prediction if client comes back to the hotel,</li>
<li>the prediction whether client orders additional services (eg. meals),</li>
<li>customer segmentation.</li>
</ul>
<p>In this project, we have decided to focus on two first issues.</p>
</div>
<div id="booking-cancellation" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Booking Cancellation</h2>
<p>The main aim of this chapter is to build model which predicts whether guest cancels reservation and use some explanation methods to analyze the reasons of customer behavior.</p>
<div id="booking-cancellation-model" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Booking Cancellation: Model</h3>
<p>In order to predict probability of booking cancellation XGBoost model has been fitted. Table below details the split of dataset.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Train</th>
<th>Test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Number of observations</strong></td>
<td>89542</td>
<td>29848</td>
</tr>
<tr class="even">
<td><strong>Number of events</strong></td>
<td>33137 (37%)</td>
<td>11087 (37%)</td>
</tr>
</tbody>
</table>
<p>Bayesian optimisation with <a href="https://nni.readthedocs.io/en/latest/Tuner/HyperoptTuner.html">TPE tuner</a> has been applied in order to improve model performance. <a href="https://github.com/microsoft/nni">Neural Network Intelligence (NNI)</a> package has been chosen for this task, because it provides user-friendly GUI with summary of experiments.</p>
<p>List of optimized hyperparameters and chosen values:</p>
<ol style="list-style-type: decimal">
<li><code>max_depth</code> - the maximum depth of tree (<code>4</code>),</li>
<li><code>n_esimators</code> - the number of trees (<code>499</code>),</li>
<li><code>learning_rate</code> - boosting learning rate (<code>0.1</code>),</li>
<li><code>colsample_bytree</code> - subsample ratio of columns when constructing each tree (<code>0.78</code>).</li>
</ol>
<p>Figure <a href="story-hotel-booking.html#fig:roc-curve">2.1</a> below shows <em>ROC curve</em> of the chosen model. The essential advantages of the model are high <em>AUC</em> and the lack of overfitting.</p>
<div class="figure" style="text-align: center"><span id="fig:roc-curve"></span>
<img src="images/03-roc_curve.png" alt="XGBoost: ROC curve" width="50%" />
<p class="caption">
FIGURE 2.1: XGBoost: ROC curve
</p>
</div>
<p>In order to compare blackbox model with an interpretable model a <em>decision tree classifier</em> was trained. It turned out that splits were made by features which are also important in the blackbox model (<em>XGBoost</em>). More details on this are given below.</p>
<div class="figure" style="text-align: center"><span id="fig:roc-curve-tree"></span>
<img src="images/03-roc_tree.png" alt="Decision Tree: ROC curve" width="50%" />
<p class="caption">
FIGURE 2.2: Decision Tree: ROC curve
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:decision-tree"></span>
<img src="images/03-decision_tree.png" alt="&quot;White box&quot; model of booking cancellation: decision tree" width="100%" />
<p class="caption">
FIGURE 2.3: “White box” model of booking cancellation: decision tree
</p>
</div>
<p>Let’s take one observation and analyze prediction of two models. We have chosen observation number <code>187</code> with features values shown in the table below. Both models predicts high probability of booking cancellation (<em>Decision Tree</em>: <strong>0.9940</strong>, <em>Xgboost</em>: <strong>0.9982</strong>). We will comment on the readability of the <em>decision tree</em> explanation by plotting the tree later.</p>
<table>
<thead>
<tr class="header">
<th>Feature</th>
<th>Value</th>
<th>Feature</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>hotel</td>
<td>0</td>
<td>arrival_date_month</td>
<td>9</td>
</tr>
<tr class="even">
<td>lead_time</td>
<td>321</td>
<td>arrival_date_week_number</td>
<td>36</td>
</tr>
<tr class="odd">
<td>arrival_date_day_of_month</td>
<td>3</td>
<td>stays_in_weekend_nights</td>
<td>0</td>
</tr>
<tr class="even">
<td>adults</td>
<td>2</td>
<td>children</td>
<td>0</td>
</tr>
<tr class="odd">
<td>babies</td>
<td>0</td>
<td>meal</td>
<td>0</td>
</tr>
<tr class="even">
<td>market_segment</td>
<td>4</td>
<td>distribution_chanel</td>
<td>3</td>
</tr>
<tr class="odd">
<td>is_repeated_guest</td>
<td>1</td>
<td>previous_cancellations</td>
<td>1</td>
</tr>
<tr class="even">
<td>previous_booking_not_canceled</td>
<td>0</td>
<td>booking_changes</td>
<td>0</td>
</tr>
<tr class="odd">
<td>deposit_type</td>
<td>0</td>
<td>days_in_waiting_list</td>
<td>0</td>
</tr>
<tr class="even">
<td>customer_type</td>
<td>3</td>
<td>adr</td>
<td>62.8</td>
</tr>
<tr class="odd">
<td>required_car_parking_spaces</td>
<td>0</td>
<td>total_of_special_requests</td>
<td>0</td>
</tr>
<tr class="even">
<td>arrival_weekday</td>
<td>2</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span id="fig:ex-breakdown"></span>
<img src="images/03-ex1.png" alt="Break down plot explaining prediciton of chosen instance" width="100%" />
<p class="caption">
FIGURE 2.4: Break down plot explaining prediciton of chosen instance
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:ex-lime"></span>
<img src="images/03-ex_lime.png" alt="LIME plot explaining prediciton of chosen instance" width="100%" />
<p class="caption">
FIGURE 2.5: LIME plot explaining prediciton of chosen instance
</p>
</div>
<p>We can see that explanation of <em>XGBoost</em> model says that features chosen in <em>decision tree</em> have also influence on prediction in <em>XGBoost</em> model. As illustrated in the figure <a href="story-hotel-booking.html#fig:ex-cp">2.6</a> if chosen client had not canceled reservation in the past, they would be less likely to cancel this reservation. What is more, if the client had booked hotel later, they would have known their plans better and it would decrease probability of cancellation. Maybe the client canceled booking because of big family event, accident or breaking up with partner (booking for 2 adults). It is impossible to predict those events in advance.</p>
<div class="figure" style="text-align: center"><span id="fig:ex-cp"></span>
<img src="images/03-ex_ceteris_paribus.png" alt="Ceteris Paribus plot explaining prediciton of chosen instance" width="85%" />
<p class="caption">
FIGURE 2.6: Ceteris Paribus plot explaining prediciton of chosen instance
</p>
</div>
<p>What is the lesson from this example? The performance of the <em>decision tree</em> is worse than <em>XGBoost</em>, so if the explanation of blackbox model is intuitive it is better to use model with higher <em>AUC</em>.</p>
</div>
<div id="booking-cancellation-explanation-dataset-level" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Booking Cancellation: Explanation, dataset level</h3>
<div class="figure" style="text-align: center"><span id="fig:03-feat-imp"></span>
<img src="images/03-permutation_fe.png" alt="Feature importance of XGBoost model" width="75%" />
<p class="caption">
FIGURE 2.7: Feature importance of XGBoost model
</p>
</div>
<p>Figure <a href="story-hotel-booking.html#fig:03-feat-imp">2.7</a> presents the feature importance. The list of five most important features contains <code>deposit_type</code> and <code>previous_cancellations</code>. Intuition suggests that these are important variables in such a problem. There are also variables <code>required_car_parking_spaces</code>, <code>total_of_special_requests</code>, <code>market_segment</code> that will be analyzed later.</p>
<div class="figure" style="text-align: center"><span id="fig:shap-summary-plot"></span>
<img src="images/03-shap_summary_plot.png" alt="Summary of SHAP values of XGBoost model" width="80%" />
<p class="caption">
FIGURE 2.8: Summary of SHAP values of XGBoost model
</p>
</div>
<p>Figure above shows <strong>SHAP values</strong>. There are some interesting findings which are intuitive:</p>
<ul>
<li>Clients who canceled some reservations in the past are more likely to cancel another reservation.</li>
<li>People who buy refundable option cancel reservations more often than others.</li>
<li>A lot of days between reservation time and arrival time increases probability of cancelling booking.</li>
<li>The longer trip, the higher probability of cancellation.</li>
</ul>
<p>There are also less intuitive findings:</p>
<ul>
<li>Trip personalization (parking spaces, special requests) makes prediction of cancellation be lower.</li>
<li>People without any special requests cancel reservation more often than others.</li>
<li>If trip starts at the end of the week there is higher probability that customers change their minds.</li>
<li>The higher number of adults, the higher probability of cancellation.</li>
<li>The probability of cancellation is lower if it is hotel in the city instead of resort hotel.</li>
</ul>
</div>
<div id="booking-cancellation-explanations-instance-level" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Booking Cancellation: Explanations, instance level</h3>
<ul>
<li>The lowest prediction of cancellation probability</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:03-shap-min-1"></span>
<img src="images/03-shap_min.png" alt="SHAP values and break down plot of XGBoost model for instance with the lowest probability of booking cancellation" width="100%" />
<p class="caption">
FIGURE 2.9: SHAP values and break down plot of XGBoost model for instance with the lowest probability of booking cancellation
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:03-shap-min-2"></span>
<img src="images/03-breakdown_min.png" alt="SHAP values and break down plot of XGBoost model for instance with the lowest probability of booking cancellation" width="100%" />
<p class="caption">
FIGURE 2.10: SHAP values and break down plot of XGBoost model for instance with the lowest probability of booking cancellation
</p>
</div>
<p>The prediction of probability of cancellation equals 0. The plot of <strong>SHAP values</strong> shows that client has booked <code>1</code> visit and has not canceled it. The values of features <code>previous_cancelations</code> and <code>previous_booking_not_canceled</code> (<code>0</code> and <code>1</code> respectively) make the probability of cancel be lower.</p>
<ul>
<li>The highest prediction of cancellation probability</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:03-shap-max-1"></span>
<img src="images/03-shap_max.png" alt="SHAP values and break down plot of XGBoost model for instance with the highest probability of booking cancellation" width="100%" />
<p class="caption">
FIGURE 2.11: SHAP values and break down plot of XGBoost model for instance with the highest probability of booking cancellation
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:03-shap-max-2"></span>
<img src="images/03-breakdown_max.png" alt="SHAP values and break down plot of XGBoost model for instance with the highest probability of booking cancellation" width="100%" />
<p class="caption">
FIGURE 2.12: SHAP values and break down plot of XGBoost model for instance with the highest probability of booking cancellation
</p>
</div>
<p>The prediction of probability of cancellation equals <em>1</em>. In the past client canceled one reservation so it is more likely to cancel another one. <code>440</code> days between reservation and arrival date makes the probability of resignation be higher. It is intuitive, because the client could have changed plans. Price per night reduces prediction. The value of <code>75</code> € per night is cheap compared to the prices in the dataset. We can guess that due to the low price, it may not be important for customers to cancel booking and wait for a refund.</p>
</div>
</div>
<div id="repeated-guests" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Repeated guests</h2>
<p>The main goal of models and explanations in this section is to effectively predict whether the guest will come to the hotel once more, and better understand the factors affecting it.</p>
<div id="repeated-guests-imbalanced-dataset" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Repeated guests: Imbalanced dataset</h3>
<p>The distribution of the answer for the second problem is noticeably imbalanced (the ratio between number of observations with given answer is around 3%). We tested various methods, which are implemented in <a href="https://imbalanced-learn.readthedocs.io/en/stable/index.html">imbalanced-learn</a> library, in different settings and found the <code>RandomUnderSampler</code> effective and sufficient for our needs as a data balancer for our main model in the second problem and <code>RandomOverSampler</code> as best balancer to use with simple <code>SGDClassifier</code>.</p>
<p>The figure below presents the distribution of <code>is_repeated_guest</code> in the dataset. The ratio of this distribution is approximately <strong>30 : 1</strong>.</p>
<div class="figure" style="text-align: center"><span id="fig:balance"></span>
<img src="images/03-balance.png" alt="The distribution of guests that are and are not repeated guest in the dataset" width="80%" />
<p class="caption">
FIGURE 2.13: The distribution of guests that are and are not repeated guest in the dataset
</p>
</div>
</div>
<div id="repeated-guests-model" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Repeated guests: Model</h3>
<p>This model is meant to predict if the given guest is a repeating guest or not. For this purpose as our main model we chose the <em>XGBClassifier</em> from <code>xgboost</code> package. As mentioned <a href="#imbalanced-dataset">above</a> we have used <em>RandomUnderSampler</em> to balance the training dataset.</p>
<p>When explaining various instances with the <strong>LIME</strong> explainer (the figure below presents the <strong>LIME</strong> explanation for the best of our first models) for one of the first models we noticed that the model highly relies on <code>previous_bookings_not_canceled</code> and <code>previous_cancellations</code> parameters. We decided to train a model without using those two variables to let the model focus on the other variables. The best models trained without <code>previous_bookings_not_canceled</code> variable had noticeably worse <em>AUC</em> score of <strong>0.9</strong> in comparison to <strong>0.967</strong> <em>AUC</em> achieved by our best models. Because of high influence on the model we decided to keep both variables.</p>
<div class="figure" style="text-align: center"><span id="fig:ex-lime-2-1"></span>
<img src="images/03-lime_2_1.png" alt="LIME explanation for the best of the first models" width="100%" />
<p class="caption">
FIGURE 2.14: LIME explanation for the best of the first models
</p>
</div>
<p>As a result of the hyper parameter search we have found the optimal set of hyper parameters including:</p>
<ul>
<li><code>max_depth</code> - the maximum depth of tree (<code>6</code>),</li>
<li><code>n_esimators</code> - the number of trees (<code>100</code>),</li>
<li><code>learning_rate</code> - boosting learning rate (<code>0.33</code>).</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:roc-2"></span>
<img src="images/03-roc_2.png" alt="ROC curve for the XGBClassifier" width="50%" />
<p class="caption">
FIGURE 2.15: ROC curve for the XGBClassifier
</p>
</div>
<p>The model achieved <strong>0.967</strong> <em>AUC</em>, and the figure above presents its <em>ROC curve</em>.</p>
<p>We also trained two simpler models - <em>SGDClassifier</em> and <em>DecisionTreeClassifier</em>. While the <em>SGDClassifier</em> (which had the best performance with increased <code>max_iter</code> parameter and when using <em>RandomOverSampler</em> balancer) had significantly worse results than the <em>XGBClassifier</em>, the <em>DecisionTreeClassifier</em> achieved AUC score of <strong>0.94</strong> with the <code>depth</code> bounded by <code>4</code>. We will focus on the <em>XGBClassifier</em> later, but for the sake of explanation we present the <code>DecisionTreeClassifier</code> tree here.</p>
<div class="figure" style="text-align: center"><span id="fig:tree-2"></span>
<img src="images/03-tree_2.png" alt="Plot of the tree of the DecisionTreeClassifier model" width="100%" />
<p class="caption">
FIGURE 2.16: Plot of the tree of the DecisionTreeClassifier model
</p>
</div>
<p>Unfortunately one can see that the “explainable by design” <em>decision tree</em> model in not easy to understand without usage of model specific methods. While we could use some <em>tree</em> specific explainers, the model agnostic explanations provide quite easy to understand and can be used with a wide range of complex, and often better performing models.</p>
</div>
<div id="repeated-guests-explanations-instance-level" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Repeated guests: Explanations, instance level</h3>
<p>We first inspected the <strong>SHAP values</strong> for two interesting instances with different correct answer. The first instance showed us that the model learned that guests coming to the hotel in October are less likely to come back and that the lack of booking changes also affects repeating negatively. This explanations are reasonable, because in contrast to the holiday guests, the non-vacation time guests probably are visiting the hotel because of some other, independent reason, that is not as repeatable as the annual vacations. The similar reasoning can be repeated for the changes in the booking and number of special requests - when one comes to some place to relax, they will probably care more about additional attractions provided by the hotel and people who visit a relaxing place, when it met their expectations, probably will come again. The second guest, that is an adult coming to the hotel regularly (<code>previous_booking_not_canceled</code>) for a weekend (<code>arrival_weekday</code> and <code>stays_in_week_nights</code>) probably will come again for one more weekend, for the same reasons as they came before.</p>
<div class="figure" style="text-align: center"><span id="fig:shap-2-1"></span>
<img src="images/03-shap_2_1.png" alt="Shapley values for a non-repeating customer" width="80%" />
<p class="caption">
FIGURE 2.17: Shapley values for a non-repeating customer
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:shap-2-2"></span>
<img src="images/03-shap_2_2.png" alt="Shapley values for a repeating customer" width="80%" />
<p class="caption">
FIGURE 2.18: Shapley values for a repeating customer
</p>
</div>
<div id="ceteris-paribus-plot-the-same-repeating-guest" class="section level4" number="2.3.3.1">
<h4><span class="header-section-number">2.3.3.1</span> <strong>Ceteris Paribus</strong> plot the same repeating guest</h4>
<p>From the <strong>Ceteris Paribus</strong> plot of <code>lead_time</code> variables for the same repeating guest as before we might get even more insight of the model’s reasoning. It clearly shows that the reservation made a year before the visit is an indicator that the guest will more likely come back. It might be a thing that this particular guest has some independent reason to visit the hotel regularly and they knows about it in advance, so because that reason probably is repeating, than they will probably visit the hotel once more.</p>
<div class="figure" style="text-align: center"><span id="fig:cp-2-2"></span>
<img src="images/03-cp_2_2.png" alt="Ceteris Paribus plot of lead_time for a repeating customer" width="85%" />
<p class="caption">
FIGURE 2.19: Ceteris Paribus plot of lead_time for a repeating customer
</p>
</div>
<p>The nonlinearity of the <strong>Ceteris Paribus</strong> profile of <code>lead_time</code> might be a clue why we were not able to achieve better results with a simple linear model. This result along with more similar ones may lead to effective feature engendering when focusing on creating less complex models.</p>
</div>
</div>
<div id="repeated-guests-explanations-dataset-level" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Repeated guests: Explanations, dataset level</h3>
<p>The attempt to understand how important are particular variables for the trained model on the dataset level by calculating <strong>Permutational Variable Imporatance</strong> gave us a clear insight that the <code>previous_booking_not_canceled</code> variable is clearly the most important one, which is very reasonable, because the guest that have visited the hotel before will probably do it once more, in the future.</p>
<div class="figure" style="text-align: center"><span id="fig:pci-2"></span>
<img src="images/03-pvi_2.png" alt="Permutational variable importance of most important variables for XGBClassifier" width="100%" />
<p class="caption">
FIGURE 2.20: Permutational variable importance of most important variables for XGBClassifier
</p>
</div>
</div>
</div>
<div id="summary-and-conclusions-1" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Summary and conclusions</h2>
<p>Using XAI methods to examine trained models were useful to understand how the trained models work, and see that the explanations are reasonable enough to use the models, along with the explanations, as a great tool for the experts to give them some interesting insights about their customers behaviours.</p>
<p>Moreover, even when explaining the complicated models we can get explanations that are easier to read and interpret than easier models, like a single <em>decision tree</em>.</p>
<p>Last, but not least, when examining the models we were able to find a dependencies, that might be a partial reason for lower performance of other very simple, but easy to understand, linear model.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="story-house-sale-prices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="story-hotel-booking-cancellations-explainable-predictions-for-booking-cancellation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/compstat-lmu/iml_methods_limitations/edit/master/02-hotel-booking.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
